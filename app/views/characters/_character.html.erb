<%= form_for [:user, :show, character] do |f| %>
  <%= render partial: "errors", locals: { object: character } %>

  <%= f.label "Character name" %>
  <%= f.text_field :name %>

  <br>

  <h3>Show:</h3>
  <%= f.collection_select(:show_id, current_user.shows, :id, :name, include_blank: true, prompt: "Select show character belongs to") %>

  <br><br>

  <%= f.label "deceased?" %>
  <%= f.check_box :deceased %>

  <br><br>

  <%= f.label "dislike?" %>
  <%= f.check_box :dislike %>

  <br><br>

  <%= f.label "quote: " %><br><br>
  <%= f.text_field :quote %>

  <br><br>

  <%= f.text_area :note, value: character.note, placeholder: "Character notes" %> <!--unsure why this value is here. editing?-->

  <br><br>

  <div class="user" data-uid="<%=current_user.id%>">
  <%= f.submit data: { disable_with: false } %>
  </div>

<% end %>

<div id="newCharacters"></div>

<script type="text/javascript" charset="utf-8">
  $(function () {
    $('form').submit(function(event) { //$('form').on("click", function(event) {s
      event.preventDefault();
      // $("form").attr("disabled", false);
      const uid = $(".user").data("uid");
      const sid = $("#character_show_id").val() //collection_select val
      const serializedForm = $(this).serialize();
      const characterCreation = $.post(`/users/${uid}/shows/${sid}/characters`, serializedForm);

      characterCreation.done(function(char) { //data currently character object
        let quote = (char.quote ? char.quote : "")
        let status = (`Status: ${char.deceased ? "Deceased" : "Alive"}`)
        let hero = (`${char.dislike ? "Villain" : "Hero"}`)

        let newCharacter = `<div>${char.name} </div> <div>${char.note} </div> <div> ${quote} </div> <div> ${status} </div> <div>${hero}</div><br>`

        $("#newCharacters").append(newCharacter);

        $('form').trigger('reset');
        //$("form").attr("disabled", "b");
      });
    });
  });
</script>
